<!doctype html><html lang="es"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>Usuarios - Biblioteca IESADEP</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="styles.css" rel="stylesheet"></head><body>
<div class="container py-4">
  <a href="index.html" class="btn btn-link">&larr; Volver</a>
  <h2>Usuarios</h2>
  <div class="d-flex mb-2">
    <input id="q" class="form-control me-2" placeholder="Buscar por nombre o documento">
    <button id="btn-search" class="btn btn-outline-primary">Buscar</button>
    <button id="btn-new" class="btn btn-primary ms-2">Nuevo usuario (admin)</button>
    <a id="export-csv" class="btn btn-success ms-2" href="/api/users/export" target="_blank">Exportar</a>
    <label class="btn btn-secondary ms-2">Importar (Excel/CSV) <input id="file-users" type="file" hidden></label>
  </div>
  <div class="table-responsive">
    <table class="table table-striped" id="tbl-users">
      <thead><tr><th>Nombre</th><th>Documento</th><th>Tel√©fono</th><th>Tipo</th><th>Acciones</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>
</div>
<script src="common.js"></script>
<script>
async function load(q){
  const res = await fetch('/api/users?q='+(q||'')); const data = await res.json();
  const tbody = document.querySelector('#tbl-users tbody'); tbody.innerHTML='';
  data.forEach(u=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${u.name}</td><td>${u.document}</td><td>${u.phone||''}</td><td>${u.type}</td>
    <td>
      <button class="btn btn-sm btn-warning btn-edit" data-id="${u.id}">Editar</button>
      <button class="btn btn-sm btn-danger btn-del" data-id="${u.id}">Eliminar</button>
    </td>`;
    tbody.appendChild(tr);
  });
  document.querySelectorAll('.btn-del').forEach(b=>{
    b.onclick = async e=>{ if(!confirm('Eliminar?')) return; const id=e.target.dataset.id; await fetch('/api/users/'+id,{method:'DELETE', headers: API.authHeaders()}); load(q); };
  });
  document.querySelectorAll('.btn-edit').forEach(b=> b.onclick = e=> alert('Usa la API para editar o implementar modal'));
}
document.getElementById('btn-search').onclick = ()=> load(document.getElementById('q').value);
document.getElementById('btn-new').onclick = ()=> alert('Crea un nuevo usuario desde la interfaz o importar CSV.'); 
document.getElementById('file-users').onchange = async e=>{
  const f = e.target.files[0]; if(!f) return;
  const fd = new FormData(); fd.append('file', f);
  await fetch('/api/users/import', {method:'POST', body: fd, headers: API.authHeaders()});
  alert('Importado (si token autorizado).'); load();
};
load();
</script>
</body></html>